#
# SPEC file for Lintel
#
Name:           Lintel
Version:        __VERSION__
URL:            http://tesla.hpl.hp.com/opensource.html
Source:         %{name}-%{version}.tar.gz
Release:        __RELEASE__
Summary:        Support tools and library 
Group:          Libraries
License:        BSD
Packager:	HPL SSD Software <software@cello.hpl.hp.com>
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

# TODO: do we split shared libraries as in debian?
%package	libs
Summary:        Lintel library files
Group:          Libraries
Requires:       %{name}-libs = %{version}-%{release}
License:        BSD

%package	devel
Summary:        Lintel devel files
Group:          Development/Libraries
Requires:       %{name}-libs = %{version}-%{release}
Requires:       cmake
License:        BSD

%package	utils
Summary:        Lintel devel files
Group:          Development/Libraries
Requires:       %{name}-libs = %{version}-%{release}, %{name}-perl
License:        BSD

%package	docs
Summary:        Lintel devel files
Group:          Development/Libraries
Requires:       %{name}-libs = %{version}-%{release}
License:        BSD

%package        perl
Summary:        Lintel perl files
Group:          Development/Libraries
Requires:       %{name}-libs = %{version}-%{release}
License:        BSD

%description
This is the meta-package for Lintel, the -{libs,devel,utils,docs,perl} sub-packages contain
the actual contents.

__DESCRIPTION_liblintel-dev__

%description	libs
The redhat packaging combinds the two Lintel C++ libraries into a single package.

__DESCRIPTION_liblintel0__

__DESCRIPTION_liblintelpthread0__

%description	devel
__DESCRIPTION_liblintel-dev__

%description    utils
__DESCRIPTION_lintel-utils__

%description    docs
__DESCRIPTION_liblintel-dev-doc__

%description    perl
__DESCRIPTION_liblintel-perl__

%prep
%setup -q

%build
mkdir rpm-build
cd rpm-build
cmake -D CMAKE_INSTALL_PREFIX=/usr ..
make -j 6
ctest

%install
cd rpm-build
rm -rf $RPM_BUILD_ROOT
make install DESTDIR=$RPM_BUILD_ROOT
pwd
ls ..
../debian/fix-install.sh $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT%{_docdir}/Lintel-%{version}
cp ../Release.info ../Changelog.mtn ../COPYING $RPM_BUILD_ROOT%{_docdir}/Lintel-%{version}
# TODO: can we make cmake automatically figure out that centos wants libs in /usr/lib64
if [ %{_libdir} != /usr/lib ]; then
        mkdir -p $RPM_BUILD_ROOT%{_libdir}
        mv $RPM_BUILD_ROOT/usr/lib/libLintel*so* $RPM_BUILD_ROOT%{_libdir}
fi

%clean
rm -rf $RPM_BUILD_ROOT rpm-build

%files libs
%{_libdir}/libLintel.so*
%{_libdir}/libLintelPThread.so*
%{_docdir}/Lintel-%{version}/COPYING
%{_docdir}/Lintel-%{version}/Release.info

%files devel
%{_includedir}/Lintel/*
%{_bindir}/lintel-config
/usr/share/cmake-modules
/usr/share/packaging/redhat-rules
/usr/share/lintel-latex-rebuild
/usr/share/Lintel/doxygen.config.in

%files utils
%{_bindir}/batch-parallel
%{_bindir}/deptool
%{_bindir}/drawRandomLogNormal
%{_bindir}/lintel-disktool
%{_bindir}/lintel-flock
%{_bindir}/lintel-latex-rebuild
%{_bindir}/mercury-plot
/usr/share/bp_modules/BatchParallel

%files docs
/usr/share/man
/usr/share/doc/Lintel
%{_docdir}/Lintel-%{version}/Changelog.mtn

%files perl
/usr/lib/perl5
/usr/share/perl5

%changelog

* Fri Mar 25 2011 anderse@hpl.hp.com 0.2011.03.12-1
- Initial rpm packaging.

